## Feeders

This module provides an opinionated way to create Cirrus feeders via config, in a manner similar to tasks and workflows.  A single feeder, generated by each folder within `cirrus_feeder_definitions_dir`, consists of:

- N number of SNS and/or S3 triggers
  - Note that this module does not *create* SNS topics or S3 buckets. Rather, it provides a way to generate the necessary AWS permissions and resources for *existing* topics and/or buckets to trigger messages to an SQS queue
- A single SQS queue to receive messages from those trigger(s)
- A single lambda function to read messages from that SQS queue, process them, and send them to the Cirrus Process Queue

**Feeder Lambda**

Your Lambda code should, in general, receive trigger events, proccess as needed, and send them to the Cirrus Process
Queue. `CIRRUS_PROCESS_QUEUE_URL` is available as an environment variable for convenience.

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.6.6 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 5.22 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | ~> 5.22 |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_resource_prefix"></a> [resource\_prefix](#input\_resource\_prefix) | String prefix to be used in every named resource. | `string` | n/a | yes |
| <a name="input_feeder_config"></a> [feeder\_config](#input\_feeder\_config) | Defines the core Cirrus feeder infrastructure.<br/><br/>`name`: (Required) Identifier for the cirrus feeder. Must be unique across all feeders. Valid characters are: `[A-Za-z0-9-]`.<br/><br/>`triggers_sns`: (Optional) List of SNS topic(s) to subscribe the feeder to. Each entry must include the `topic_arn` and may optionally include `delivery_policy`, `filter_policy`, `filter_policy_scope`, and `raw_message_delivery`. See Terraform's [aws\_sns\_topic\_subscription](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic_subscription) resource documentation for details.<br/><br/>`triggers_s3`: (Optional) List of S3 bucket(s) to configure event notifications on. Each entry must include the `bucket_name`, `bucket_arn`, and `events` attributes, and may optionally include `filter_prefix` and `filter_suffix`. See Terraform's [aws\_s3\_bucket\_notification](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_notification) resource documentation for details.<br/><br/>`sqs`: (Optional) Configuration for the feeder's SQS queue. If not provided, defaults will be used. See Terraform's [aws\_sqs\_queue](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue) resource documentation for details.<br/><br/>`lambda`: The standard config for Cirrus Task and Feeder Lambdas. See the /cirrus/task/README.md for full details. | <pre>object({<br/>    name = string<br/><br/>    triggers_sns = optional(list(object({<br/>      topic_arn            = string<br/>      delivery_policy      = optional(string)<br/>      filter_policy        = optional(string)<br/>      filter_policy_scope  = optional(string)<br/>      raw_message_delivery = optional(bool)<br/>    })))<br/><br/>    triggers_s3 = optional(list(object({<br/>      bucket_name   = string<br/>      bucket_arn    = string<br/>      events        = list(string)<br/>      filter_prefix = optional(string)<br/>      filter_suffix = optional(string)<br/>    })))<br/><br/>    sqs = optional(object({<br/>      delay_seconds              = optional(number)<br/>      max_message_size           = optional(number)<br/>      message_retention_seconds  = optional(number)<br/>      receive_wait_time_seconds  = optional(number)<br/>      visibility_timeout_seconds = optional(number)<br/>      max_receive_count          = optional(number)<br/>    }))<br/><br/>    lambda = optional(object({<br/>      description               = optional(string)<br/>      ecr_image_uri             = optional(string)<br/>      resolve_ecr_tag_to_digest = optional(bool)<br/>      filename                  = optional(string)<br/>      image_config = optional(object({<br/>        command           = optional(list(string))<br/>        entry_point       = optional(list(string))<br/>        working_directory = optional(string)<br/>      }))<br/>      s3_bucket       = optional(string)<br/>      s3_key          = optional(string)<br/>      handler         = optional(string)<br/>      runtime         = optional(string)<br/>      timeout_seconds = optional(number)<br/>      memory_mb       = optional(number)<br/>      publish         = optional(bool)<br/>      architectures   = optional(list(string))<br/>      env_vars        = optional(map(string))<br/>      vpc_enabled     = optional(bool)<br/>      role_statements = optional(list(object({<br/>        sid           = string<br/>        effect        = string<br/>        actions       = list(string)<br/>        resources     = list(string)<br/>        not_actions   = optional(list(string))<br/>        not_resources = optional(list(string))<br/>        condition = optional(object({<br/>          test     = string<br/>          variable = string<br/>          values   = list(string)<br/>        }))<br/>        principals = optional(object({<br/>          type        = string<br/>          identifiers = list(string)<br/>        }))<br/>        not_principals = optional(object({<br/>          type        = string<br/>          identifiers = list(string)<br/>        }))<br/>      })))<br/>      alarms = optional(list(object({<br/>        critical            = bool<br/>        statistic           = string<br/>        metric_name         = string<br/>        comparison_operator = string<br/>        threshold           = number<br/>        period              = optional(number, 60)<br/>        evaluation_periods  = optional(number, 5)<br/>      })))<br/>    }))<br/>    #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br/>  })</pre> | n/a | yes |
| <a name="input_vpc_subnet_ids"></a> [vpc\_subnet\_ids](#input\_vpc\_subnet\_ids) | List of subnet ids in the target VPC that cirrus the lambda resources should be connected to. | `list(string)` | n/a | yes |
| <a name="input_vpc_security_group_ids"></a> [vpc\_security\_group\_ids](#input\_vpc\_security\_group\_ids) | List of security groups in the target VPC that cirrus the lambda resources should use. | `list(string)` | n/a | yes |
| <a name="input_warning_sns_topic_arn"></a> [warning\_sns\_topic\_arn](#input\_warning\_sns\_topic\_arn) | SNS topic to be used by all `warning` alarms.<br/><br/>If any non-critical alarms are configured via `var.feeder_config.lambda.alarms`, they will use this SNS topic for their alarm action. | `string` | `null` | no |
| <a name="input_critical_sns_topic_arn"></a> [critical\_sns\_topic\_arn](#input\_critical\_sns\_topic\_arn) | SNS topic to be used by all `critical` alarms.<br/><br/>If any critical alarms are configured via `var.feeder_config.lambda.alarms`, they will use this SNS topic for their alarm action. | `string` | `null` | no |
| <a name="input_builtin_feeder_definitions_variables"></a> [builtin\_feeder\_definitions\_variables](#input\_builtin\_feeder\_definitions\_variables) | Predefined builtin variables, such as `CIRRUS_DATA_BUCKET`, that are set in the `cirrus` module. | `map(string)` | `{}` | no |
| <a name="input_cirrus_process_sqs_queue_url"></a> [cirrus\_process\_sqs\_queue\_url](#input\_cirrus\_process\_sqs\_queue\_url) | URL of the cirrus process queue. Given that feeders' primary function is to enqueue messages to the process queue this is required. | `string` | n/a | yes |

## Outputs

No outputs.
<!-- END_TF_DOCS -->