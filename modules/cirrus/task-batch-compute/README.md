# task-batch-compute

Used by the `cirrus` module to create cirrus task batch compute resources. Aside
from using the [Inputs](#inputs) section below as a reference for creating
`task-batch-compute` YAML definitions, interactions with this module should
happen through the interface provided by the `cirrus` module rather than using
this module directly.

<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.6.6 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | ~> 5.22 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | ~> 5.22 |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_resource_prefix"></a> [resource\_prefix](#input\_resource\_prefix) | String prefix to be used in every named resource. | `string` | n/a | yes |
| <a name="input_vpc_subnet_ids"></a> [vpc\_subnet\_ids](#input\_vpc\_subnet\_ids) | List of subnet ids in the target VPC that cirrus task batch compute resources should be connected to. | `list(string)` | n/a | yes |
| <a name="input_vpc_security_group_ids"></a> [vpc\_security\_group\_ids](#input\_vpc\_security\_group\_ids) | List of security groups in the target VPC that cirrus task batch compute resources should use. | `list(string)` | n/a | yes |
| <a name="input_batch_compute_config"></a> [batch\_compute\_config](#input\_batch\_compute\_config) | Defines a single set of cirrus task batch compute resources. This set may be used by zero..many batch cirrus tasks (see `task` module).<br/><br/>`name`: Identifier for the cirrus batch compute resources. Must be unique across all cirrus compute resource sets. Valid characters are: `[A-Za-z0-9-]`.<br/><br/>`batch_compute_environment_existing`: Identifies an existing compute environment in the current AWS account. If specified, this module will use that CE instead of creating a new one. Useful if the argument subset exposed in the `batch_compute_config.batch_compute_environment` variable is insufficient and/or you've deployed your own CE through other means. Object contents:<br/>- `batch_compute_environment_existing.name`: Name of the existing CE.<br/>- `batch_compute_environment_existing.is_fargate`: Whether the existing CE uses Fargate.<br/><br/>`batch_compute_environment`: Used to create a compute environment with necessary ancillary resources. This exposes a minimal subset of the arguments available in the `aws_batch_compute_environment` resource. Refer to that resource's [documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/batch_compute_environment) for more information on the available arguments. Object contents:<br/>- `batch_compute_environment.compute_resources`<br/>- `batch_compute_environment.state`<br/>- `batch_compute_environment.type`<br/>- `batch_compute_environment.update_policy`<br/><br/>`batch_job_queue_existing`: Identifies an existing job queue in the current AWS account. If specified, this module will use that queue instead of creating a new one. Object contents:<br/>- `batch_job_queue_existing.name`: Name of the existing job queue.<br/><br/>`batch_job_queue`: Used to create a job queue with the necessary ancillary resources and automatic attachment to the target CE defined above. Only necessary if the job queue requires a fair share scheduling policy; if omitted, a default job queue will be created. Object contents:<br/>- `batch_job_queue.fair_share_policy`: Used to create and attach an `aws_batch_scheduling_policy` resource to the job queue. Refer to that resource's [documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/batch_scheduling_policy) for more information on the available arguments. To utilize any defined share identifiers, you will need to add `ShareIdentifer` with the applicable value under `Parameters` in a cirrus workflow state machine definition.<br/><br/>`ec2_launch_template_existing`: Identifies an existing launch template in the current AWS account. If specified, this module will use that template instead of creating a new one. Useful if the argument subset exposed in the `batch_compute_config.ec2_launch_template` variable is insufficient and you've deployed your own template through other means. Object contents:<br/>- `ec2_launch_template_existing.name`: Name of the existing launch template.<br/><br/>`ec2_launch_template`:  Used to create a launch template with the necessary ancillary resources. This exposes a minimal subset of the arguments available in the `aws_launch_template` resource. Refer to that resource's [documentation](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_template) for more information on the available arguments. Object contents:<br/>- `ec2_launch_template.user_data`<br/>- `ec2_launch_template.ebs_optimized`<br/>- `ec2_launch_template.block_device_mappings`<br/><br/>Prefer to configure the resources above through this module and not through the `_existing` arguments wherever possible; this ensures consistent resource configuration and behavior across the Cirrus deployment.<br/>#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ | <pre>object({<br/>    name = string<br/><br/>    batch_compute_environment_existing = optional(object({<br/>      name       = string<br/>      is_fargate = bool<br/>    }))<br/><br/>    batch_compute_environment = optional(object({<br/>      compute_resources = object({<br/>        max_vcpus           = number<br/>        type                = string<br/>        allocation_strategy = optional(string)<br/>        bid_percentage      = optional(number)<br/>        desired_vcpus       = optional(number)<br/>        ec2_configuration = optional(object({<br/>          image_id_override = optional(string)<br/>          image_type        = optional(string)<br/>        }))<br/>        ec2_key_pair       = optional(string)<br/>        instance_type      = optional(list(string))<br/>        min_vcpus          = optional(number)<br/>        placement_group    = optional(string)<br/>        security_group_ids = optional(list(string))<br/>        subnets            = optional(list(string))<br/>      })<br/>      state = optional(string)<br/>      type  = optional(string)<br/>      update_policy = optional(object({<br/>        job_execution_timeout_minutes = number<br/>        terminate_jobs_on_update      = bool<br/>      }))<br/>    }))<br/><br/>    batch_job_queue_existing = optional(object({<br/>      name = string<br/>    }))<br/><br/>    batch_job_queue = optional(object({<br/>      fair_share_policy = optional(object({<br/>        compute_reservation = optional(number)<br/>        share_decay_seconds = optional(number)<br/>        share_distributions = list(object({<br/>          share_identifier = string<br/>          weight_factor    = number<br/>        }))<br/>      }))<br/>      state = optional(string)<br/>    }))<br/><br/>    ec2_launch_template_existing = optional(object({<br/>      name = string<br/>    }))<br/><br/>    ec2_launch_template = optional(object({<br/>      user_data     = optional(string)<br/>      ebs_optimized = optional(bool)<br/>      block_device_mappings = optional(list(object({<br/>        device_name  = string<br/>        no_device    = optional(bool)<br/>        virtual_name = optional(string)<br/>        ebs = optional(object({<br/>          delete_on_termination = optional(bool)<br/>          encrypted             = optional(bool)<br/>          iops                  = optional(string)<br/>          kms_key_id            = optional(string)<br/>          snapshot_id           = optional(string)<br/>          throughput            = optional(number)<br/>          volume_size           = optional(number)<br/>          volume_type           = optional(string)<br/>        }))<br/>      })))<br/>    }))<br/>    #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br/>  })</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_batch"></a> [batch](#output\_batch) | Output ARNs and attributes for the resulting cirrus task batch compute resources. |
<!-- END_TF_DOCS -->
